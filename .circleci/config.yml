version: 2.1

orbs:
  node: circleci/node@7

workflows:
  ci:
    jobs:
      - node/run:
          name: lint
          pkg-manager: pnpm
          pnpm-run: lint
          setup:
            - node/install-pnpm:
                version: '10.29.3'
      - node/test:
          name: test-node-18
          pkg-manager: pnpm
          executor:
            name: node/default
            tag: '18.20'
          setup:
            - node/install-pnpm:
                version: '10.29.3'
          post_install_steps:
            - run: pnpm build
          test-results-for: jest
      - node/test:
          name: test-node-20
          pkg-manager: pnpm
          executor:
            name: node/default
            tag: '20.11'
          setup:
            - node/install-pnpm:
                version: '10.29.3'
          post_install_steps:
            - run: pnpm build
          test-results-for: jest
      - node/test:
          name: test-node-22
          pkg-manager: pnpm
          executor:
            name: node/default
            tag: '22'
          setup:
            - node/install-pnpm:
                version: '10.29.3'
          post_install_steps:
            - run: pnpm build
          test-results-for: jest
